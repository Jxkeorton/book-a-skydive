{% extends "base.html" %}

{% block content %}
<h1 class="mb-4">User Profile</h1>
<p>Welcome to your profile, <strong>{{ user.username }}</strong>!</p>
<p>Your email: <strong>{{ user.email }}</strong></p>

<h2 class="mt-4">Current Bookings</h2>
<p>Here you will be able to track all of your current bookings.</p>

{% if has_bookings %}
    <!-- Tandem Bookings Section -->
    <h2>Tandem Bookings</h2>
    <ul class="list-group mb-4">
        {% if tandem_bookings %}
            {% for booking in tandem_bookings %}
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    {{ booking.full_name }} - {{ booking.email }} on {{ booking.timeslot.day.date }}
                    <div>
                        <a href="#" class="btn btn-warning btn-sm">Edit</a>
                        <form action="{% url 'tandems:delete_booking' booking.id %}" method="post" style="display:inline;">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-danger btn-sm">Delete</button>
                        </form>
                    </div>
                </li>
            {% endfor %}
        {% else %}
            <li class="list-group-item">No tandem bookings found.</li>
        {% endif %}
    </ul>

    <!-- AFF Course Bookings Section -->
    <h2>AFF Course Bookings</h2>
    <ul class="list-group mb-4">
        {% if course_bookings %}
            {% for course in course_bookings %}
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    {{ course.full_name }} - {{ course.email }} for course on {{ course.course.date }}
                    <div>
                        <a href="#" class="btn btn-warning btn-sm">Edit</a>
                        <button type="button" data-booking-id="{{ course.id }}" data-booking-type="course" class="btn btn-danger btn-sm btn-delete">Delete</button>
                    </div>
                </li>
            {% endfor %}
        {% else %}
            <li class="list-group-item">No AFF course bookings found.</li>
        {% endif %}
    </ul>

    <!-- Experienced Jump Bookings Section -->
    <h2>Experienced Bookings</h2>
    <ul class="list-group mb-4">
        {% if experienced_bookings %}
            {% for jump in experienced_bookings %}
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    {{ jump.plane }} - {{ jump.jumpslot.departure|date:"g:i a" }}
                    <div>
                        <a href="#" class="btn btn-warning btn-sm">Edit</a>
                        <button type="button" data-booking-id="{{ jump.id }}" class="btn btn-danger btn-sm btn-delete">Delete</button>
                    </div>
                </li>
            {% endfor %}
        {% else %}
            <li class="list-group-item">No experienced jump bookings found.</li>
        {% endif %}
    </ul>
{% else %}
    <h3>You currently have no bookings.</h3>
{% endif %}

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteModalLabel">Confirm Deletion</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                Are you sure you want to delete this booking?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <a id="deleteConfirm" class="btn btn-danger" href="#">Delete</a>
            </div>
        </div>
    </div>
</div>

{% endblock %}
